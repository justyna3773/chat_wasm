import{i as M,S as P,I as N}from"./vendor.d7632843.js";const R=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const d of t.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function l(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=l(e);fetch(e.href,t)}};R();async function C(o){const l=await(await fetch(o)).arrayBuffer();return new Uint8Array(l)}async function D(){try{let x=function(){window.requestAnimationFrame(async()=>{console.time("frame"),await F(),console.timeEnd("frame"),x()})};const o=fetch("./data/models/squeeze-labels.txt").then(c=>c.text()),[r,l,i]=await Promise.all([C("./data/models/opt-squeeze.onnx"),M(),o]);console.log("Initialized",{modelBytes:r,initResult:l,Session:P,labelsResult:i});const e=224,t=224,d=await P.fromBytes(r),g=i.split(/\n/g);console.log({labelsList:g});const y=document.getElementById("player"),z={video:!0},E=await navigator.mediaDevices.getUserMedia(z);y.srcObject=E;const s=document.createElement("canvas");s.width=e,s.height=t;const p=s.getContext("2d",{willReadFrequently:!0});let h=0,w=0;async function F(){try{p.drawImage(y,0,0,s.width,s.height);const c=p.getImageData(0,0,s.width,s.height),b=new Float32Array(224*224*3),L=3,I=4;let _=[.485,.456,.406],O=[.229,.224,.225];for(let n=0;n<L;n++)for(let a=0;a<t;a++)for(let u=0;u<e;u++){const $=c.data[a*e*I+u*I+n]/255;b[n*(e*t)+a*e+u]=($-_[n])/O[n]}const f=new N;f.insert("data",b);const S=performance.now(),A=await d.run(f),T=performance.now()-S;h++,w+=T,f.free();const v=A.get("squeezenet0_flatten0_reshape0");let m=-1,q=-1;for(let n=0;n<v.length;n++){const a=v[n];a>m&&(m=a,q=n)}document.getElementById("log").innerText=`${g[q]} (${m})`;const B=w/h;document.getElementById("perf").innerText=`Inference time: ${B.toFixed(2)}ms, at most ${Math.floor(1e3/B)} fps`}catch(c){console.error(c,c.toString())}}x()}catch(o){console.error(o,o.toString())}}D();
